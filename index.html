base<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skunk Fu - 2D Beat 'em Up Platformer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="1280" height="720"></canvas>
        <div id="loading-screen">
            <div class="loading-content">
                <h1>Skunk Fu</h1>
                <div class="loading-bar">
                    <div id="loading-progress" class="loading-progress"></div>
                </div>
                <p id="loading-text">Loading assets...</p>
            </div>
        </div>
        <!-- Touch Controls for Mobile -->
        <div id="touch-controls">
            <button class="touch-btn" id="btn-left">&#8592;</button>
            <button class="touch-btn" id="btn-right">&#8594;</button>
            <button class="touch-btn" id="btn-jump">&#8593;</button>
            <button class="touch-btn" id="btn-attack">&#x2694;</button>
        </div>
        <!-- Mobile Start Overlay -->
        <div id="mobile-start-overlay" style="display:none;">
            <button id="mobile-start-btn">Tap to Start</button>
        </div>
    </div>

    <!-- Game scripts -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/spriteLoader.js"></script>
    <script src="js/audioManager.js"></script>
    <script src="js/visualEffects.js"></script>
    <script src="js/level.js"></script>
    <script src="js/player.js"></script>
    <script src="js/enemy.js"></script>
    <script src="js/enemyManager.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
<script>
// Touch controls event mapping
let leftBtn = document.getElementById('btn-left');
let rightBtn = document.getElementById('btn-right');
let jumpBtn = document.getElementById('btn-jump');
let attackBtn = document.getElementById('btn-attack');

function triggerKeyEvent(key, type) {
    const event = new KeyboardEvent(type, { key });
    window.dispatchEvent(event);
}

if (leftBtn && rightBtn && jumpBtn && attackBtn) {
    leftBtn.addEventListener('touchstart', e => { e.preventDefault(); triggerKeyEvent('ArrowLeft', 'keydown'); });
    leftBtn.addEventListener('touchend', e => { e.preventDefault(); triggerKeyEvent('ArrowLeft', 'keyup'); });
    rightBtn.addEventListener('touchstart', e => { e.preventDefault(); triggerKeyEvent('ArrowRight', 'keydown'); });
    rightBtn.addEventListener('touchend', e => { e.preventDefault(); triggerKeyEvent('ArrowRight', 'keyup'); });
    jumpBtn.addEventListener('touchstart', e => { e.preventDefault(); triggerKeyEvent(' ', 'keydown'); triggerKeyEvent('ArrowUp', 'keydown'); });
    jumpBtn.addEventListener('touchend', e => { e.preventDefault(); triggerKeyEvent(' ', 'keyup'); triggerKeyEvent('ArrowUp', 'keyup'); });
    attackBtn.addEventListener('touchstart', e => { e.preventDefault(); triggerKeyEvent('z', 'keydown'); });
    attackBtn.addEventListener('touchend', e => { e.preventDefault(); triggerKeyEvent('z', 'keyup'); });
}

// Mobile Start Overlay logic
function isMobile() {
    return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
}
const mobileStartOverlay = document.getElementById('mobile-start-overlay');
const mobileStartBtn = document.getElementById('mobile-start-btn');

function showMobileStartOverlay() {
    if (mobileStartOverlay) mobileStartOverlay.style.display = 'flex';
}
function hideMobileStartOverlay() {
    if (mobileStartOverlay) mobileStartOverlay.style.display = 'none';
}

if (isMobile() && mobileStartBtn) {
    // Show overlay on load
    showMobileStartOverlay();
    // Tap to start (simulate ENTER)
    mobileStartBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        triggerKeyEvent('Enter', 'keydown');
        triggerKeyEvent('Enter', 'keyup');
        hideMobileStartOverlay();
    });
    // Listen for game state changes to show/hide overlay
    window.addEventListener('gameStateChange', function(e) {
        if (e.detail && (e.detail.state === 'MENU' || e.detail.state === 'GAME_OVER')) {
            showMobileStartOverlay();
        } else {
            hideMobileStartOverlay();
        }
    });
}
</script>
</body>
</html>
